#!/usr/bin/env node

const errorReporter = require('../lib/reporters/error-reporter');
const fastatic = require('../index');
const filesizeReporter = require('../lib/reporters/filesize-reporter');
const Logger = require('../lib/logger');
const pkg = require('../package');

const program = require('commander')
	.version(pkg.version)
	.description(`${pkg.name} (v${pkg.version}): ${pkg.description}`)
	.usage('<src> [options]')
	.option('-d, --dest [value]', 'Output destination')
	.option('-l, --log-level [value]', 'Log level (silent|error|warn|verbose)', 'verbose')
	.parse(process.argv);

const logger = new Logger(program.logLevel);

fastatic({
		src: program.args[0],
		dest: program.dest,
		logLevel: program.logLevel
	})
	.then(output => {
		const { filesize, dest } = output;
		filesizeReporter(filesize, program.logLevel);
		logger.log(`Done. Optimised static files in: ${dest}`);
	})
	.catch(err => {
		errorReporter(err, program.logLevel);
		logger.log(`Optimising failed. See above for details.`);
		process.exitCode = 1;
	});
